{% extends 'layout.html' %}
{% block title %}Track Complaint{% endblock %}
{% block extra_head %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
<link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/bodymovin/5.10.1/lottie.min.js"></script>
<style>
    body { background:#fff; font-family:'Roboto',sans-serif; padding-bottom:80px; }
    h1 { text-align:center; margin:20px 0; }
    .track-form-wrapper { display:flex; justify-content:center; margin-top:30px; width:100%; }
    .form-box { display:flex; align-items:center; background:#fff; border-radius:50px; box-shadow:0 4px 12px rgba(0,0,0,0.1); padding:6px 12px; width:100%; max-width:400px; }
    .form-box input { flex:1; border:none; outline:none; font-size:16px; padding:12px 15px; border-radius:50px; color:#333; }
    .form-box input::placeholder { color:#888; }
    #trackButton { width:50px; height:50px; border-radius:50%; border:none; display:flex; justify-content:center; align-items:center; cursor:pointer; background:linear-gradient(135deg,#6d28d9,#9333ea,#a855f7); background-size:200% 200%; color:#fff; font-size:20px; margin-left:8px; transition:all 0.3s ease; animation:gradientMove 3s infinite; }
    #trackButton:hover { transform:scale(1.08); box-shadow:0 5px 15px rgba(109,40,217,0.3); }
    @keyframes gradientMove { 0% { background-position:0% 50%; } 50% { background-position:100% 50%; } 100% { background-position:0% 50%; } }
    .loading-spinner { border:3px solid rgba(255,255,255,0.3); border-top-color:#fff; border-radius:50%; width:22px; height:22px; animation:spin 0.8s linear infinite; }
    @keyframes spin { to { transform:rotate(360deg); } }
    .no-data-animation-container { width:80%; max-width:800px; margin:30px auto; text-align:center; display:none; opacity:0; transition:opacity .8s ease-in-out; }
    .no-data-animation-container.show { display:block; opacity:1; }
    #no-data-animation { width:100%; height:350px; margin:0 auto; }
    .no-data-text { font-size:18px; font-weight:500; color:#cc0000; margin-top:15px; }

    .complaint-history-container { width:90%; max-width:1000px; margin:40px auto; overflow-x:auto; }
    .complaint-history-container table { width:100%; border-collapse:collapse; }
    .complaint-history-container th, .complaint-history-container td { padding:10px 12px; text-align:left; }

    .fade-in-up { animation:fadeInUp .6s ease-out both; }
    @keyframes fadeInUp { from{opacity:0; transform:translateY(20px);} to{opacity:1; transform:translateY(0);} }

    .step.active .circle { background-color:#28a745; transform:scale(1.1); animation:pulse 1.5s ease-in-out infinite; }
    @keyframes pulse { 0%,100%{box-shadow:0 0 0 0 rgba(40,167,69,0.6);} 50%{box-shadow:0 0 0 10px rgba(40,167,69,0);} }

    @media (max-width:640px){
      .form-box{max-width:90%;}
      .complaint-tracker{flex-direction:column; gap:20px;}
      .complaint-history-container th, .complaint-history-container td{font-size:14px;}
    }
    footer.dev-footer {
      position: fixed;
      left: 0;
      bottom: 0;
      width: 100%;
      padding: 15px;
      background: linear-gradient(135deg, #0d47a1, #1976d2);
      color: white;
      text-align: center;
      font-size: 14px;
      font-family: 'Roboto', sans-serif;
    }
    footer.dev-footer a { color: #ffeb3b; text-decoration: none; }
    footer.dev-footer a:hover { text-decoration: underline; }
</style>
{% endblock %}
{% block header_actions %}
<button class="button" onclick="window.open('https://maps.google.com?q=Countrylink+Broadband+Office', '_blank')">
    <i class="fas fa-map-marker-alt"></i>
</button>
{% endblock %}
{% block tabs %}
    <div class="tab"><a href="/complaints"><i class="fas fa-code-branch"></i> Complaints</a></div>
    <div class="tab"><a href="https://countrylinks.in" target="_blank"><i class="fas fa-globe"></i> Internet Plans</a></div>
    <div class="tab"><a href="#"><i class="fas fa-star"></i> Review</a></div>
{% endblock %}
{% block content %}
<h1>Track Your Complaint</h1>
<form id="trackForm" method="POST" action="{{ url_for('track') }}" class="track-form-wrapper">
    <div class="form-box">
        <input type="text" name="mobile" placeholder="Enter Mobile Number" required>
        <button id="trackButton" type="submit">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 64 64" id="trackIcon">
                <path fill-opacity="0.01" fill="white" d="M63.6689 29.0491L34.6198 63.6685L0.00043872 34.6194L29.0496 0L63.6689 29.0491Z"></path>
                <path stroke-linejoin="round" stroke-linecap="round" stroke-width="3.76603" stroke="white" d="M42.8496 18.7067L21.0628 44.6712"></path>
                <path stroke-linejoin="round" stroke-linecap="round" stroke-width="3.76603" stroke="white" d="M26.9329 20.0992L42.85 18.7067L44.2426 34.6238"></path>
            </svg>
        </button>
    </div>
</form>
{% if status %}
<div class="complaint-tracker fade-in-up">
    <div class="step {{ 'active' if status in ['Registered','Pending','Assigned','Complete'] else '' }}">
        <div class="circle"><i class="fas fa-check"></i></div>
        <div class="label">Registered</div>
    </div>
    <div class="step {{ 'active' if status in ['Pending','Assigned','Complete'] else '' }}">
        <div class="circle"><i class="fas fa-spinner"></i></div>
        <div class="label">Pending</div>
    </div>
    <div class="step {{ 'active' if status in ['Assigned','Complete'] else '' }}">
        <div class="circle"><i class="fas fa-user-cog"></i></div>
        <div class="label">Assigned</div>
    </div>
    <div class="step {{ 'active' if status == 'Complete' else '' }}">
        <div class="circle"><i class="fas fa-check-circle"></i></div>
        <div class="label">Complete</div>
    </div>
</div>
{% endif %}
{% if complaints %}
<div class="complaint-history-container fade-in-up">
    <h2><i class="fas fa-clock"></i> Complaint History</h2>
    <table>
        <thead>
            <tr>
                <th>ID</th><th>Name</th><th>Mobile</th><th>Complaint</th><th>Status</th>
            </tr>
        </thead>
        <tbody>
            {% for comp in complaints %}
            <tr>
                <td>{{ comp[0] }}</td>
                <td>{{ comp[1] }}</td>
                <td>{{ comp[2] }}</td>
                <td>{{ comp[3] }}</td>
                <td><span class="badge badge-{{ comp[4]|lower }}">{{ comp[4] }}</span></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% elif request.method == 'POST' and not complaints %}
<div id="no-data-container" class="no-data-animation-container fade-in-up">
    <div id="no-data-animation"></div>
    <p class="no-data-text">No complaint found. Please type a valid mobile number.</p>
</div>
{% endif %}

<!-- üåü Footer -->
<footer class="dev-footer">
    <div style="margin-bottom: 6px;">
        <i class="fas fa-code"></i> Developed with ‚ù§Ô∏è by 
        <a href="https://www.linkedin.com/in/suraj-sonawane-76495564/" target="_blank"><strong>Suraj Sonawane</strong></a>
    </div>
    <div>
        &copy; {{ current_year }} Countrylink Broadband
    </div>
</footer>

{% endblock %}
{% block extra_scripts %}
<script>
document.addEventListener("DOMContentLoaded",function(){
    const c=document.getElementById('no-data-container');
    if(c){
        c.classList.add('show');
        lottie.loadAnimation({
            container:document.getElementById('no-data-animation'),
            renderer:'svg',
            loop:true,autoplay:true,
            path:"{{ url_for('static', filename='animations/caveman.json') }}"
        });
    }
});
</script>
<script>
document.getElementById("trackForm").addEventListener("submit", function(e){
    e.preventDefault();
    const form=this;
    const btn=document.getElementById('trackButton');
    const icon=document.getElementById('trackIcon');
    if(icon) icon.outerHTML='<div class="loading-spinner"></div>';
    btn.disabled=true;
    btn.classList.add('opacity-70','cursor-not-allowed');
    setTimeout(()=>form.submit(),1000);
});
</script>
{% endblock %}
