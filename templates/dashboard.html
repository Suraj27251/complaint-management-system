<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<nav><div class="nav-brand">Complaint Admin Dashboard</div></nav>

<div class="dashboard">
  <div class="card-container">
    <div class="card"><h3>Total</h3><p>{{ total }}</p></div>
    <div class="card"><h3>Unassigned</h3><p>{{ unassigned }}</p></div>
    <div class="card"><h3>In Progress</h3><p>{{ in_progress }}</p></div>
    <div class="card"><h3>Completed</h3><p>{{ completed }}</p></div>
  </div>

  <h2>All Complaints</h2>
  <table>
    <thead>
      <tr><th>ID</th><th>Name</th><th>Issue</th><th>Mobile</th><th>Date</th>
          <th>Status</th><th>Assigned</th><th>Comment</th><th>Action</th></tr>
    </thead>
    <tbody>
      {% for comp in complaints %}
      <tr>
        <form method="POST" action="{{ url_for('update_complaint', complaint_id=comp[0]) }}">
          <td>{{ comp[0] }}</td>
          <td>{{ comp[1] }}</td>
          <td>{{ comp[2] }}</td>
          <td>{{ comp[3] }}</td>
          <td>{{ comp[4] }}</td>
          <td>
            <select name="status">
              {% for st in ['Unassigned','In Progress','Completed'] %}
                <option value="{{ st }}" {% if comp[5]==st %}selected{% endif %}>{{ st }}</option>
              {% endfor %}
            </select>
          </td>
          <td><input type="text" name="assigned_to" value="{{ comp[6] }}"></td>
          <td><input type="text" name="comment" value="{{ comp[7] }}"></td>
          <td><button type="submit">Update</button></td>
        </form>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <div class="chart-container">
    <canvas id="barChart"></canvas>
    <canvas id="pieChart"></canvas>
  </div>
</div>

<script>
  new Chart(document.getElementById('barChart'), {
    type: 'bar',
    data: {
      labels:['Unassigned','In Progress','Completed'],
      datasets:[{ data:[{{unassigned}},{{in_progress}},{{completed}}], backgroundColor:['#ffc107','#17a2b8','#28a745'] }]
    }
  });
  new Chart(document.getElementById('pieChart'), {
    type: 'pie',
    data: {
      labels:['Unassigned','In Progress','Completed'],
      datasets:[{ data:[{{unassigned}},{{in_progress}},{{completed}}], backgroundColor:['#ffc107','#17a2b8','#28a745'] }]
    }
  });
</script>
</body>
</html>
